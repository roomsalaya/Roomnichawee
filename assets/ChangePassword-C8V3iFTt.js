import{r as n,j as s}from"./index-DgKVGHIq.js";import{c as P,e as R,R as U,C as B,B as b,F as D,j as A,k as L,d as T,m as V,b6 as z}from"./Footer-BggieqwG.js";import{N as $,S as q,M as G}from"./Navbar-oRDaupqi.js";/* empty css                  */import{C as H}from"./index-CkFSPcmI.js";import{s as d}from"./index-QF8AJRaD.js";const Y=()=>{const[w,S]=n.useState([]),[t,l]=n.useState(null),[a,o]=n.useState(null),[v,i]=n.useState(!1),[N,u]=n.useState(!1),[m,x]=n.useState(""),f=P(),h=R(),j=f.currentUser;n.useEffect(()=>{j&&(async()=>{i(!0);try{const r=A(h,"users"),y=(await L(r)).docs.map(c=>({id:c.id,...c.data()}));y.sort((c,F)=>{const M=parseInt(c.room,10),I=parseInt(F.room,10);return M-I}),S(y)}catch(r){console.error("Error fetching users:",r),d.error("เกิดข้อผิดพลาดในการดึงข้อมูลผู้ใช้")}finally{i(!1)}})()},[j,h]);const k=e=>{(t==null?void 0:t.id)===e.id?(l(null),o(null)):(l(e),o({...e}),u(!0))},E=async()=>{if(a&&t){i(!0);try{const e=T(h,"users",t.id);if(await V(e,a),m){const r=f.currentUser;r&&(await z(r,m),d.success("รหัสผ่านถูกเปลี่ยนเรียบร้อยแล้ว"))}l(null),o(null),x(""),d.success("อัปเดตข้อมูลสำเร็จ"),u(!1)}catch(e){console.error("Error updating user:",e),d.error("เกิดข้อผิดพลาดในการอัปเดตข้อมูล")}finally{i(!1)}}},g=(e,r)=>{o(p=>p?{...p,[r]:e.target.value}:{})},C=()=>{u(!1),l(null),o(null)};return s.jsxs(s.Fragment,{children:[s.jsx($,{}),s.jsxs("div",{className:"admin-container",children:[s.jsx("h2",{children:"จัดการข้อมูลผู้ใช้"}),v?s.jsx(q,{size:"large"}):s.jsx(s.Fragment,{children:s.jsx("div",{className:"user-list",children:s.jsx(U,{gutter:[16,8],children:w.map(e=>s.jsx(B,{span:12,children:s.jsx(H,{title:e.room,onClick:()=>k(e),hoverable:!0,className:`user-card ${(t==null?void 0:t.id)===e.id?"selected":""}`})},e.id))})})}),s.jsx(G,{title:"ข้อมูลผู้ใช้",visible:N,onCancel:C,children:t&&s.jsxs("form",{children:[s.jsxs("label",{children:["ชื่อ:",s.jsx("input",{type:"text",className:"input-field",value:(a==null?void 0:a.name)||"",onChange:e=>g(e,"name")})]}),s.jsxs("label",{children:["ห้อง:",s.jsx("input",{type:"text",className:"input-field",value:(a==null?void 0:a.room)||"",onChange:e=>g(e,"room")})]}),s.jsxs("label",{children:["รหัสผ่านใหม่:",s.jsx("input",{type:"password",className:"input-field",value:m,onChange:e=>x(e.target.value)})]}),s.jsxs("div",{style:{marginTop:"16px"},children:[s.jsx(b,{onClick:C,style:{marginRight:"8px"},children:"ยกเลิก"},"cancel"),s.jsx(b,{type:"primary",onClick:E,children:"อัปเดตข้อมูล"},"submit")]})]})})]}),s.jsx(D,{})]})};export{Y as default};
