import{r as u,j as r}from"./index-BWJa64qi.js";import{l as B,Y as R,H as G,d as W,f as O,c as Q,Z as T,m as Z,L as J,u as j,r as ee,$ as ne,N as te,C as ae,a0 as ie,a1 as ce,a2 as le,a3 as re,y as oe,F as se,o as A,n as de,q as V,w as he,X as ue}from"./Footer-stKjf6O3.js";import{N as me,S as ge,M as Se}from"./Navbar-DmkU5xNr.js";import{F as v}from"./index-WjkCZu6W.js";import{C as pe}from"./index-BbGVA9iY.js";import{I as z}from"./index-CUOgbI1p.js";import{s as L}from"./index-BYn6s3mX.js";import"./Dropdown-DjcU_FJn.js";var $e=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],X=u.forwardRef(function(e,n){var l,i=e.prefixCls,s=i===void 0?"rc-switch":i,h=e.className,g=e.checked,c=e.defaultChecked,a=e.disabled,o=e.loadingIcon,m=e.checkedChildren,f=e.unCheckedChildren,p=e.onClick,C=e.onChange,k=e.onKeyDown,F=B(e,$e),E=R(!1,{value:g,defaultValue:c}),I=G(E,2),M=I[0],w=I[1];function D($,N){var t=M;return a||(t=$,w(t),C==null||C(t,N)),t}function H($){$.which===T.LEFT?D(!1,$):$.which===T.RIGHT&&D(!0,$),k==null||k($)}function b($){var N=D(!M,$);p==null||p(N,$)}var q=W(s,h,(l={},O(l,"".concat(s,"-checked"),M),O(l,"".concat(s,"-disabled"),a),l));return u.createElement("button",Q({},F,{type:"button",role:"switch","aria-checked":M,disabled:a,className:q,ref:n,onKeyDown:H,onClick:b}),o,u.createElement("span",{className:"".concat(s,"-inner")},u.createElement("span",{className:"".concat(s,"-inner-checked")},m),u.createElement("span",{className:"".concat(s,"-inner-unchecked")},f)))});X.displayName="Switch";const fe=e=>{const{componentCls:n,trackHeightSM:l,trackPadding:i,trackMinWidthSM:s,innerMinMarginSM:h,innerMaxMarginSM:g,handleSizeSM:c,calc:a}=e,o=`${n}-inner`,m=j(a(c).add(a(i).mul(2)).equal()),f=j(a(g).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:s,height:l,lineHeight:j(l),[`${n}-inner`]:{paddingInlineStart:g,paddingInlineEnd:h,[`${o}-checked, ${o}-unchecked`]:{minHeight:l},[`${o}-checked`]:{marginInlineStart:`calc(-100% + ${m} - ${f})`,marginInlineEnd:`calc(100% - ${m} + ${f})`},[`${o}-unchecked`]:{marginTop:a(l).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:c,height:c},[`${n}-loading-icon`]:{top:a(a(c).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:h,paddingInlineEnd:g,[`${o}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${o}-unchecked`]:{marginInlineStart:`calc(100% - ${m} + ${f})`,marginInlineEnd:`calc(-100% + ${m} - ${f})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${j(a(c).add(i).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${o}`]:{[`${o}-unchecked`]:{marginInlineStart:a(e.marginXXS).div(2).equal(),marginInlineEnd:a(e.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${o}`]:{[`${o}-checked`]:{marginInlineStart:a(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:a(e.marginXXS).div(2).equal()}}}}}}},Ce=e=>{const{componentCls:n,handleSize:l,calc:i}=e;return{[n]:{[`${n}-loading-icon${e.iconCls}`]:{position:"relative",top:i(i(l).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:e.switchColor}}}},be=e=>{const{componentCls:n,trackPadding:l,handleBg:i,handleShadow:s,handleSize:h,calc:g}=e,c=`${n}-handle`;return{[n]:{[c]:{position:"absolute",top:l,insetInlineStart:l,width:h,height:h,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:i,borderRadius:g(h).div(2).equal(),boxShadow:s,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${c}`]:{insetInlineStart:`calc(100% - ${j(g(h).add(l).equal())})`},[`&:not(${n}-disabled):active`]:{[`${c}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${c}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},Ie=e=>{const{componentCls:n,trackHeight:l,trackPadding:i,innerMinMargin:s,innerMaxMargin:h,handleSize:g,calc:c}=e,a=`${n}-inner`,o=j(c(g).add(c(i).mul(2)).equal()),m=j(c(h).mul(2).equal());return{[n]:{[a]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:h,paddingInlineEnd:s,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${a}-checked, ${a}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:l},[`${a}-checked`]:{marginInlineStart:`calc(-100% + ${o} - ${m})`,marginInlineEnd:`calc(100% - ${o} + ${m})`},[`${a}-unchecked`]:{marginTop:c(l).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${a}`]:{paddingInlineStart:s,paddingInlineEnd:h,[`${a}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${a}-unchecked`]:{marginInlineStart:`calc(100% - ${o} + ${m})`,marginInlineEnd:`calc(-100% + ${o} - ${m})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${a}`]:{[`${a}-unchecked`]:{marginInlineStart:c(i).mul(2).equal(),marginInlineEnd:c(i).mul(-1).mul(2).equal()}},[`&${n}-checked ${a}`]:{[`${a}-checked`]:{marginInlineStart:c(i).mul(-1).mul(2).equal(),marginInlineEnd:c(i).mul(2).equal()}}}}}},we=e=>{const{componentCls:n,trackHeight:l,trackMinWidth:i}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},ee(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:i,height:l,lineHeight:j(l),verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:e.colorTextTertiary}}),ne(e)),{[`&${n}-checked`]:{background:e.switchColor,[`&:hover:not(${n}-disabled)`]:{background:e.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},ve=e=>{const{fontSize:n,lineHeight:l,controlHeight:i,colorWhite:s}=e,h=n*l,g=i/2,c=2,a=h-c*2,o=g-c*2;return{trackHeight:h,trackHeightSM:g,trackMinWidth:a*2+c*4,trackMinWidthSM:o*2+c*2,trackPadding:c,handleBg:s,handleSize:a,handleSizeSM:o,handleShadow:`0 2px 4px 0 ${new te("#00230b").setAlpha(.2).toRgbString()}`,innerMinMargin:a/2,innerMaxMargin:a+c+c*2,innerMinMarginSM:o/2,innerMaxMarginSM:o+c+c*2}},ye=Z("Switch",e=>{const n=J(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[we(n),Ie(n),be(n),Ce(n),fe(n)]},ve);var xe=function(e,n){var l={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.indexOf(i)<0&&(l[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)n.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(l[i[s]]=e[i[s]]);return l};const ke=u.forwardRef((e,n)=>{const{prefixCls:l,size:i,disabled:s,loading:h,className:g,rootClassName:c,style:a,checked:o,value:m,defaultChecked:f,defaultValue:p,onChange:C}=e,k=xe(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[F,E]=R(!1,{value:o??m,defaultValue:f??p}),{getPrefixCls:I,direction:M,switch:w}=u.useContext(ae),D=u.useContext(ie),H=(s??D)||h,b=I("switch",l),q=u.createElement("div",{className:`${b}-handle`},h&&u.createElement(re,{className:`${b}-loading-icon`})),[$,N,t]=ye(b),d=ce(i),S=W(w==null?void 0:w.className,{[`${b}-small`]:d==="small",[`${b}-loading`]:h,[`${b}-rtl`]:M==="rtl"},g,c,N,t),y=Object.assign(Object.assign({},w==null?void 0:w.style),a),x=function(){E(arguments.length<=0?void 0:arguments[0]),C==null||C.apply(void 0,arguments)};return $(u.createElement(le,{component:"Switch"},u.createElement(X,Object.assign({},k,{checked:F,onChange:x,prefixCls:b,className:S,style:y,disabled:H,ref:n,loadingIcon:q}))))}),Y=ke;Y.__ANT_SWITCH=!0;const qe=()=>{const[e,n]=u.useState("มกราคม"),[l,i]=u.useState(new Date().getFullYear()),[s,h]=u.useState(!1),[g,c]=u.useState([]),[a,o]=u.useState(!0),[m,f]=u.useState(null),[p]=v.useForm(),[C,k]=u.useState({}),[F,E]=u.useState(0),I=oe();u.useEffect(()=>{(async()=>{o(!0);try{const d=A(I,"users"),y=(await de(d)).docs.map(x=>({id:x.id,...x.data()}));c(y)}catch(d){console.error("Error fetching users data: ",d)}finally{o(!1)}})()},[I]),u.useEffect(()=>{(async()=>{const d=l+543,S=`${e} ${d}`;try{const y=V(I,"electricityData",S),x=await he(y);x.exists()?k(x.data()):(console.log("No electricity data found for the selected month and year."),k(M()))}catch(y){console.error("Error fetching electricity data: ",y)}})()},[e,l,I]);const M=()=>["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"].reduce((d,S)=>(d[S]={previous:"0",current:"0",units:"0",amount:"0"},d),{}),w=t=>{n(t.target.value)},D=t=>{i(Number(t.target.value))},H=()=>{h(!1),p.resetFields(),E(0)},b=async()=>{var t;try{const d={userId:m.id,month:e,year:l,rent:p.getFieldValue("rent"),water:p.getFieldValue("water"),electricity:((t=C[m.room])==null?void 0:t.amount)||"ไม่ระบุ",fine:p.getFieldValue("fine"),total:F,roomStatus:p.getFieldValue("roomStatus")?"จ่ายแล้ว":"ค้างชำระ"},S=V(A(I,"invoices"));await ue(S,d),L.success("บิลแจ้งหนี้ถูกส่งเรียบร้อยแล้ว!"),h(!1),p.resetFields(),E(0)}catch(d){console.error("Error saving invoice data: ",d),L.error("เกิดข้อผิดพลาดในการส่งบิลแจ้งหนี้")}},q=t=>{var d,S;f(t),p.setFieldsValue({room:t.room||"ไม่ระบุ",rent:t.rent||"",water:t.water||"",electricity:((d=C[t.room])==null?void 0:d.amount)||"ไม่ระบุ",fine:"",roomStatus:t.roomStatus||!1,total:`${$(t.rent,t.water,(S=C[t.room])==null?void 0:S.amount)}`}),h(!0)},$=(t,d,S,y="0")=>{const x=parseFloat(t||"0"),K=parseFloat(d||"0"),_=parseFloat(S||"0"),U=parseFloat(y||"0"),P=x+K+_+U;return E(P),p.setFieldsValue({total:`${P}`}),P},N=(t,d)=>{var S;$(d.rent,d.water,(S=C[m==null?void 0:m.room])==null?void 0:S.amount,d.fine)};return r.jsxs(r.Fragment,{children:[r.jsx(me,{}),r.jsxs("div",{className:"invoice-form-container",children:[r.jsx("h3",{children:"เลือกรอบบิล"}),r.jsx("select",{className:"form-select","aria-label":"เลือกเดือน",value:e,onChange:w,children:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"].map(t=>r.jsx("option",{value:t,children:t},t))}),r.jsx("select",{className:"form-select","aria-label":"เลือกปี",value:l,onChange:D,children:Array.from({length:10},(t,d)=>new Date().getFullYear()+d).map(t=>r.jsx("option",{value:t.toString(),children:t},t))}),a?r.jsx(ge,{size:"large"}):r.jsx("div",{className:"cards-container",children:g.map(t=>r.jsxs(pe,{title:`ห้อง: ${t.room||"ไม่ระบุ"}`,bordered:!0,style:{width:300,marginTop:16,cursor:"pointer"},onClick:()=>q(t),children:[r.jsxs("p",{children:["ชื่อ: ",t.name]}),r.jsxs("p",{children:["ค่าเช่า: ",t.rent?`${t.rent} บาท`:"ไม่ระบุ"]})]},t.id))}),r.jsx(Se,{title:"ทำบิลแจ้งหนี้ค่าเช่า",visible:s,onCancel:H,footer:null,children:m&&r.jsxs(v,{form:p,layout:"vertical",onValuesChange:N,children:[r.jsx(v.Item,{label:"ห้อง",name:"room",children:r.jsx(z,{placeholder:"ห้อง",disabled:!0})}),r.jsx(v.Item,{label:"ค่าเช่า",name:"rent",children:r.jsx(z,{placeholder:"ใส่ค่าเช่า"})}),r.jsx(v.Item,{label:"ค่าน้ำ",name:"water",children:r.jsx(z,{placeholder:"ใส่ค่าน้ำ"})}),r.jsx(v.Item,{label:"ค่าไฟ",name:"electricity",children:r.jsx(z,{placeholder:"ค่าไฟ",disabled:!0})}),r.jsx(v.Item,{label:"ค่าปรับ",name:"fine",children:r.jsx(z,{placeholder:"ใส่ค่าปรับ"})}),r.jsx(v.Item,{label:"สถานะห้อง",name:"roomStatus",valuePropName:"checked",children:r.jsx(Y,{checkedChildren:"จ่ายแล้ว",unCheckedChildren:"ค้างชำระ"})}),r.jsx(v.Item,{label:"รวม",name:"total",children:r.jsx(z,{placeholder:"ยอดรวมทั้งหมด",disabled:!0})}),r.jsx(v.Item,{children:r.jsx("button",{className:"btn btn-primary",onClick:b,children:"ส่งบิลแจ้งหนี้"})})]})})]}),r.jsx(se,{})]})};export{qe as default};
