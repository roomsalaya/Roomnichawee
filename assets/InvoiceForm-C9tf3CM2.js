import{p as u,m as B,ad as R,V as G,d as W,f as O,c as Q,ae as T,o as Z,Z as J,u as j,r as ee,af as ne,a0 as te,C as ae,ag as ie,ah as ce,ai as le,aj as oe,z as v,M as re,q as o,N as se,S as de,aa as he,B as z,F as ue,t as A,s as me,w as V,K as ge,ac as Se,y as L}from"./index-D0hLmu_5.js";import{C as pe}from"./index-5UlKleQb.js";var $e=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],X=u.forwardRef(function(e,n){var l,i=e.prefixCls,s=i===void 0?"rc-switch":i,h=e.className,g=e.checked,c=e.defaultChecked,a=e.disabled,r=e.loadingIcon,m=e.checkedChildren,C=e.unCheckedChildren,p=e.onClick,b=e.onChange,k=e.onKeyDown,F=B(e,$e),E=R(!1,{value:g,defaultValue:c}),w=G(E,2),M=w[0],I=w[1];function D($,N){var t=M;return a||(t=$,I(t),b==null||b(t,N)),t}function H($){$.which===T.LEFT?D(!1,$):$.which===T.RIGHT&&D(!0,$),k==null||k($)}function f($){var N=D(!M,$);p==null||p(N,$)}var q=W(s,h,(l={},O(l,"".concat(s,"-checked"),M),O(l,"".concat(s,"-disabled"),a),l));return u.createElement("button",Q({},F,{type:"button",role:"switch","aria-checked":M,disabled:a,className:q,ref:n,onKeyDown:H,onClick:f}),r,u.createElement("span",{className:"".concat(s,"-inner")},u.createElement("span",{className:"".concat(s,"-inner-checked")},m),u.createElement("span",{className:"".concat(s,"-inner-unchecked")},C)))});X.displayName="Switch";const Ce=e=>{const{componentCls:n,trackHeightSM:l,trackPadding:i,trackMinWidthSM:s,innerMinMarginSM:h,innerMaxMarginSM:g,handleSizeSM:c,calc:a}=e,r=`${n}-inner`,m=j(a(c).add(a(i).mul(2)).equal()),C=j(a(g).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:s,height:l,lineHeight:j(l),[`${n}-inner`]:{paddingInlineStart:g,paddingInlineEnd:h,[`${r}-checked, ${r}-unchecked`]:{minHeight:l},[`${r}-checked`]:{marginInlineStart:`calc(-100% + ${m} - ${C})`,marginInlineEnd:`calc(100% - ${m} + ${C})`},[`${r}-unchecked`]:{marginTop:a(l).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:c,height:c},[`${n}-loading-icon`]:{top:a(a(c).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:h,paddingInlineEnd:g,[`${r}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${r}-unchecked`]:{marginInlineStart:`calc(100% - ${m} + ${C})`,marginInlineEnd:`calc(-100% + ${m} - ${C})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${j(a(c).add(i).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${r}`]:{[`${r}-unchecked`]:{marginInlineStart:a(e.marginXXS).div(2).equal(),marginInlineEnd:a(e.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${r}`]:{[`${r}-checked`]:{marginInlineStart:a(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:a(e.marginXXS).div(2).equal()}}}}}}},be=e=>{const{componentCls:n,handleSize:l,calc:i}=e;return{[n]:{[`${n}-loading-icon${e.iconCls}`]:{position:"relative",top:i(i(l).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:e.switchColor}}}},fe=e=>{const{componentCls:n,trackPadding:l,handleBg:i,handleShadow:s,handleSize:h,calc:g}=e,c=`${n}-handle`;return{[n]:{[c]:{position:"absolute",top:l,insetInlineStart:l,width:h,height:h,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:i,borderRadius:g(h).div(2).equal(),boxShadow:s,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${c}`]:{insetInlineStart:`calc(100% - ${j(g(h).add(l).equal())})`},[`&:not(${n}-disabled):active`]:{[`${c}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${c}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},we=e=>{const{componentCls:n,trackHeight:l,trackPadding:i,innerMinMargin:s,innerMaxMargin:h,handleSize:g,calc:c}=e,a=`${n}-inner`,r=j(c(g).add(c(i).mul(2)).equal()),m=j(c(h).mul(2).equal());return{[n]:{[a]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:h,paddingInlineEnd:s,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${a}-checked, ${a}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:l},[`${a}-checked`]:{marginInlineStart:`calc(-100% + ${r} - ${m})`,marginInlineEnd:`calc(100% - ${r} + ${m})`},[`${a}-unchecked`]:{marginTop:c(l).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${a}`]:{paddingInlineStart:s,paddingInlineEnd:h,[`${a}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${a}-unchecked`]:{marginInlineStart:`calc(100% - ${r} + ${m})`,marginInlineEnd:`calc(-100% + ${r} - ${m})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${a}`]:{[`${a}-unchecked`]:{marginInlineStart:c(i).mul(2).equal(),marginInlineEnd:c(i).mul(-1).mul(2).equal()}},[`&${n}-checked ${a}`]:{[`${a}-checked`]:{marginInlineStart:c(i).mul(-1).mul(2).equal(),marginInlineEnd:c(i).mul(2).equal()}}}}}},Ie=e=>{const{componentCls:n,trackHeight:l,trackMinWidth:i}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},ee(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:i,height:l,lineHeight:j(l),verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:e.colorTextTertiary}}),ne(e)),{[`&${n}-checked`]:{background:e.switchColor,[`&:hover:not(${n}-disabled)`]:{background:e.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},ve=e=>{const{fontSize:n,lineHeight:l,controlHeight:i,colorWhite:s}=e,h=n*l,g=i/2,c=2,a=h-c*2,r=g-c*2;return{trackHeight:h,trackHeightSM:g,trackMinWidth:a*2+c*4,trackMinWidthSM:r*2+c*2,trackPadding:c,handleBg:s,handleSize:a,handleSizeSM:r,handleShadow:`0 2px 4px 0 ${new te("#00230b").setAlpha(.2).toRgbString()}`,innerMinMargin:a/2,innerMaxMargin:a+c+c*2,innerMinMarginSM:r/2,innerMaxMarginSM:r+c+c*2}},ye=Z("Switch",e=>{const n=J(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[Ie(n),we(n),fe(n),be(n),Ce(n)]},ve);var xe=function(e,n){var l={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.indexOf(i)<0&&(l[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)n.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(l[i[s]]=e[i[s]]);return l};const ke=u.forwardRef((e,n)=>{const{prefixCls:l,size:i,disabled:s,loading:h,className:g,rootClassName:c,style:a,checked:r,value:m,defaultChecked:C,defaultValue:p,onChange:b}=e,k=xe(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[F,E]=R(!1,{value:r??m,defaultValue:C??p}),{getPrefixCls:w,direction:M,switch:I}=u.useContext(ae),D=u.useContext(ie),H=(s??D)||h,f=w("switch",l),q=u.createElement("div",{className:`${f}-handle`},h&&u.createElement(oe,{className:`${f}-loading-icon`})),[$,N,t]=ye(f),d=ce(i),S=W(I==null?void 0:I.className,{[`${f}-small`]:d==="small",[`${f}-loading`]:h,[`${f}-rtl`]:M==="rtl"},g,c,N,t),y=Object.assign(Object.assign({},I==null?void 0:I.style),a),x=function(){E(arguments.length<=0?void 0:arguments[0]),b==null||b.apply(void 0,arguments)};return $(u.createElement(le,{component:"Switch"},u.createElement(X,Object.assign({},k,{checked:F,onChange:x,prefixCls:f,className:S,style:y,disabled:H,ref:n,loadingIcon:q}))))}),K=ke;K.__ANT_SWITCH=!0;const Ee=()=>{const[e,n]=u.useState("มกราคม"),[l,i]=u.useState(new Date().getFullYear()),[s,h]=u.useState(!1),[g,c]=u.useState([]),[a,r]=u.useState(!0),[m,C]=u.useState(null),[p]=v.useForm(),[b,k]=u.useState({}),[F,E]=u.useState(0),w=re();u.useEffect(()=>{(async()=>{r(!0);try{const d=A(w,"users"),y=(await me(d)).docs.map(x=>({id:x.id,...x.data()}));c(y)}catch(d){console.error("Error fetching users data: ",d)}finally{r(!1)}})()},[w]),u.useEffect(()=>{(async()=>{const d=l+543,S=`${e} ${d}`;try{const y=V(w,"electricityData",S),x=await ge(y);x.exists()?k(x.data()):(console.log("No electricity data found for the selected month and year."),k(M()))}catch(y){console.error("Error fetching electricity data: ",y)}})()},[e,l,w]);const M=()=>["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"].reduce((d,S)=>(d[S]={previous:"0",current:"0",units:"0",amount:"0"},d),{}),I=t=>{n(t.target.value)},D=t=>{i(Number(t.target.value))},H=()=>{h(!1),p.resetFields(),E(0)},f=async()=>{var t;try{const d={userId:m.id,month:e,year:l,rent:p.getFieldValue("rent"),water:p.getFieldValue("water"),electricity:((t=b[m.room])==null?void 0:t.amount)||"ไม่ระบุ",fine:p.getFieldValue("fine"),total:F,roomStatus:p.getFieldValue("roomStatus")?"จ่ายแล้ว":"ค้างชำระ"},S=V(A(w,"invoices"));await Se(S,d),L.success("บิลแจ้งหนี้ถูกส่งเรียบร้อยแล้ว!"),h(!1),p.resetFields(),E(0)}catch(d){console.error("Error saving invoice data: ",d),L.error("เกิดข้อผิดพลาดในการส่งบิลแจ้งหนี้")}},q=t=>{var d,S;C(t),p.setFieldsValue({room:t.room||"ไม่ระบุ",rent:t.rent||"",water:t.water||"",electricity:((d=b[t.room])==null?void 0:d.amount)||"ไม่ระบุ",fine:"",roomStatus:t.roomStatus||!1,total:`${$(t.rent,t.water,(S=b[t.room])==null?void 0:S.amount)}`}),h(!0)},$=(t,d,S,y="0")=>{const x=parseFloat(t||"0"),Y=parseFloat(d||"0"),_=parseFloat(S||"0"),U=parseFloat(y||"0"),P=x+Y+_+U;return E(P),p.setFieldsValue({total:`${P}`}),P},N=(t,d)=>{var S;$(d.rent,d.water,(S=b[m==null?void 0:m.room])==null?void 0:S.amount,d.fine)};return o.jsxs(o.Fragment,{children:[o.jsx(se,{}),o.jsxs("div",{className:"invoice-form-container",children:[o.jsx("h3",{children:"เลือกรอบบิล"}),o.jsx("select",{className:"form-select","aria-label":"เลือกเดือน",value:e,onChange:I,children:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"].map(t=>o.jsx("option",{value:t,children:t},t))}),o.jsx("select",{className:"form-select","aria-label":"เลือกปี",value:l,onChange:D,children:Array.from({length:10},(t,d)=>new Date().getFullYear()+d).map(t=>o.jsx("option",{value:t.toString(),children:t},t))}),a?o.jsx(de,{size:"large"}):o.jsx("div",{className:"cards-container",children:g.map(t=>o.jsxs(pe,{title:`ห้อง: ${t.room||"ไม่ระบุ"}`,bordered:!0,style:{width:300,marginTop:16,cursor:"pointer"},onClick:()=>q(t),children:[o.jsxs("p",{children:["ชื่อ: ",t.name]}),o.jsxs("p",{children:["ค่าเช่า: ",t.rent?`${t.rent} บาท`:"ไม่ระบุ"]})]},t.id))}),o.jsx(he,{title:"ทำบิลแจ้งหนี้ค่าเช่า",visible:s,onCancel:H,footer:null,children:m&&o.jsxs(v,{form:p,layout:"vertical",onValuesChange:N,children:[o.jsx(v.Item,{label:"ห้อง",name:"room",children:o.jsx(z,{placeholder:"ห้อง",disabled:!0})}),o.jsx(v.Item,{label:"ค่าเช่า",name:"rent",children:o.jsx(z,{placeholder:"ใส่ค่าเช่า"})}),o.jsx(v.Item,{label:"ค่าน้ำ",name:"water",children:o.jsx(z,{placeholder:"ใส่ค่าน้ำ"})}),o.jsx(v.Item,{label:"ค่าไฟ",name:"electricity",children:o.jsx(z,{placeholder:"ค่าไฟ",disabled:!0})}),o.jsx(v.Item,{label:"ค่าปรับ",name:"fine",children:o.jsx(z,{placeholder:"ใส่ค่าปรับ"})}),o.jsx(v.Item,{label:"สถานะห้อง",name:"roomStatus",valuePropName:"checked",children:o.jsx(K,{checkedChildren:"จ่ายแล้ว",unCheckedChildren:"ค้างชำระ"})}),o.jsx(v.Item,{label:"รวม",name:"total",children:o.jsx(z,{placeholder:"ยอดรวมทั้งหมด",disabled:!0})}),o.jsx(v.Item,{children:o.jsx("button",{className:"btn btn-primary",onClick:f,children:"ส่งบิลแจ้งหนี้"})})]})})]}),o.jsx(ue,{})]})};export{Ee as default};
