import{r,j as t}from"./index-BJ1mkKvj.js";import{e as E,c as L,F as N,j as Y,k as b}from"./Footer-Dfnne6q2.js";import{N as D,a as h,S as A,M as V}from"./Navbar-N01Wbqa6.js";import{F as $}from"./Table-BXDHCso0.js";import{s as z}from"./index-dqNNSWee.js";import"./index-BQt-TnC-.js";import"./index-D6QCiGSK.js";import"./EyeOutlined-BSeyjRwm.js";const{Option:B}=h,u={มกราคม:1,กุมภาพันธ์:2,มีนาคม:3,เมษายน:4,พฤษภาคม:5,มิถุนายน:6,กรกฎาคม:7,สิงหาคม:8,กันยายน:9,ตุลาคม:10,พฤศจิกายน:11,ธันวาคม:12},Q=()=>{const[i,f]=r.useState([]),[x,g]=r.useState([]),[S,l]=r.useState(!0),[j,c]=r.useState(null),[I,d]=r.useState(!1),[n,P]=r.useState(new Date().getFullYear()),m=E(),y=L();r.useEffect(()=>{(async()=>{l(!0);try{const s=y.currentUser;if(s){const M=s.uid,v=Y(m,"payments"),p=(await b(v)).docs.map(a=>({id:a.id,...a.data()})).filter(a=>a.userId===M);p.sort((a,o)=>a.year===o.year?u[a.month]-u[o.month]:a.year-o.year),f(p)}}catch(s){console.error("Error fetching payment history: ",s),z.error("Failed to load payment history. Please try again.")}finally{l(!1)}})()},[m,y]),r.useEffect(()=>{const e=i.filter(s=>s.year===n);g(e)},[i,n]);const w=e=>{P(e)},k=e=>{c(e),d(!0)},F=()=>{d(!1),c(null)},C=[{title:"เดือน",dataIndex:"month",key:"month"},{title:"ปี",dataIndex:"year",key:"year",render:e=>e+543},{title:"ยอดรวม",dataIndex:"total",key:"total",render:e=>`${e} บาท`},{title:"ภาพหลักฐาน",dataIndex:"uploadedImage",key:"uploadedImage",render:e=>t.jsx("img",{src:e,alt:"Payment Slip",style:{width:"100px",cursor:"pointer"},onClick:()=>k(e)})},{title:"เวลา",dataIndex:"timestamp",key:"timestamp",render:e=>new Date(e.seconds*1e3).toLocaleString()},{title:"สถานะ",dataIndex:"roomStatus",key:"roomStatus",render:e=>t.jsx("span",{className:`room-status ${e==="จ่ายแล้ว"?"paid":"pending"}`,children:e==="จ่ายแล้ว"?"จ่ายแล้ว":"รอตรวจสอบ"})}];return t.jsxs(t.Fragment,{children:[t.jsx(D,{}),t.jsxs("div",{className:"payment-history-container",children:[t.jsx("h3",{children:"ประวัติการชำระเงิน"}),t.jsx("div",{style:{marginBottom:"16px"},children:t.jsx(h,{value:n,onChange:w,style:{width:200},placeholder:"เลือกปี",allowClear:!0,children:Array.from({length:7},(e,s)=>2567+s).map(e=>t.jsx(B,{value:e-543,children:e},e))})}),S?t.jsx(A,{size:"large"}):t.jsx($,{dataSource:x,columns:C,rowKey:"id",pagination:!1}),t.jsx(V,{visible:I,footer:null,onCancel:F,centered:!0,width:600,children:t.jsx("img",{src:j||"",alt:"Payment Slip",style:{width:"100%"}})})]}),t.jsx(N,{})]})};export{Q as default};
