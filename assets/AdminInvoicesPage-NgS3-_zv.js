import{r as a,j as n}from"./index-6khG2Yf5.js";import{e as P,F as T,j as U,l as K,B as v,d as F,n as M,m as q}from"./Footer-Cbq9hSoz.js";import{N as z,a as u,S as G}from"./Navbar--SWFEH57.js";import{F as H}from"./Table-CPSwFRZk.js";import{I as p}from"./index-CtH8D21f.js";import{s as f}from"./index-BXCxonc7.js";import"./index-CQ6jledo.js";import"./Dropdown-WOv9cyra.js";import"./index-CMim-1d4.js";import"./EyeOutlined-CmgoZAMV.js";const E={มกราคม:1,กุมภาพันธ์:2,มีนาคม:3,เมษายน:4,พฤษภาคม:5,มิถุนายน:6,กรกฎาคม:7,สิงหาคม:8,กันยายน:9,ตุลาคม:10,พฤศจิกายน:11,ธันวาคม:12},oe=()=>{const[s,x]=a.useState([]),[B,j]=a.useState(!0),[I,C]=a.useState(void 0),[S,R]=a.useState(void 0),[i,w]=a.useState({}),h=P();a.useEffect(()=>{(async()=>{j(!0);try{const t=U(h,"invoices"),l=(await K(t)).docs.map(o=>({id:o.id,...o.data()}));l.sort((o,m)=>{const y=E[o.month]||0,g=E[m.month]||0;return y-g||o.year-m.year}),x(l)}catch(t){console.error("Error fetching invoices data: ",t)}finally{j(!1)}})()},[h]);const c=async(e,t)=>{try{const r=F(h,"invoices",e),l=s.find(o=>o.id===e);if(l){const o={...l,...t},m=parseFloat(o.rent)||0,y=parseFloat(o.water)||0,g=parseFloat(o.electricity)||0,_=parseFloat(o.fine)||0,k=m+y+g+_;await M(r,{...t,total:k}),f.success("ข้อมูลบิลได้ถูกแก้ไขเรียบร้อยแล้ว!");const b=s.map(d=>d.id===e?{...d,...t,total:k}:d);x(b),w(d=>({...d,[e]:!1}))}}catch(r){console.error("Error updating invoice: ",r),f.error("เกิดข้อผิดพลาดในการแก้ไขข้อมูลบิล!")}},V=async e=>{try{const t=F(h,"invoices",e);await q(t),f.success("ข้อมูลบิลได้ถูกลบเรียบร้อยแล้ว!"),x(s.filter(r=>r.id!==e))}catch(t){console.error("Error deleting invoice: ",t),f.error("เกิดข้อผิดพลาดในการลบข้อมูลบิล!")}},A=e=>{C(e)},D=e=>{R(e)},L=s.filter(e=>(!I||e.room===I)&&(!S||e.year===S)),N=async(e,t)=>{await c(e,{roomStatus:t==="จ่ายแล้ว"?"ค้างชำระ":"จ่ายแล้ว"})},O=e=>{w(t=>({...t,[e]:!t[e]}))},Y=[{title:"ห้อง",dataIndex:"room",key:"room"},{title:"เดือนที่แจ้งหนี้",dataIndex:"month",key:"month"},{title:"ปี (พ.ศ.)",dataIndex:"year",key:"year",render:e=>e+543},{title:"ค่าเช่า (บาท)",dataIndex:"rent",key:"rent",render:(e,t)=>i[t.id]?n.jsx(p,{defaultValue:e,onBlur:r=>c(t.id,{rent:r.target.value})}):n.jsx("span",{children:e})},{title:"ค่าน้ำ (บาท)",dataIndex:"water",key:"water",render:(e,t)=>i[t.id]?n.jsx(p,{defaultValue:e,onBlur:r=>c(t.id,{water:r.target.value})}):n.jsx("span",{children:e})},{title:"ค่าไฟ (บาท)",dataIndex:"electricity",key:"electricity",render:(e,t)=>i[t.id]?n.jsx(p,{defaultValue:e,onBlur:r=>c(t.id,{electricity:r.target.value})}):n.jsx("span",{children:e})},{title:"ค่าปรับ (บาท)",dataIndex:"fine",key:"fine",render:(e,t)=>i[t.id]?n.jsx(p,{defaultValue:e,onBlur:r=>c(t.id,{fine:r.target.value})}):n.jsx("span",{children:e})},{title:"ยอดรวม (บาท)",dataIndex:"total",key:"total"},{title:"สถานะห้อง",dataIndex:"roomStatus",key:"roomStatus",render:(e,t)=>n.jsxs(n.Fragment,{children:[n.jsx("span",{children:e}),n.jsx(v,{onClick:()=>N(t.id,e),style:{marginLeft:8},children:"เปลี่ยนสถานะ"})]})},{title:"ดาวน์โหลด PDF",dataIndex:"pdfUrl",key:"pdfUrl",render:e=>e?n.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:"ดาวน์โหลด"}):"ไม่มีไฟล์"},{title:"แก้ไข/บันทึก",key:"edit",render:(e,t)=>n.jsx(v,{onClick:()=>O(t.id),children:i[t.id]?"บันทึก":"แก้ไข"})},{title:"ลบ",key:"delete",render:(e,t)=>n.jsx(v,{onClick:()=>V(t.id),danger:!0,children:"ลบ"})}];return n.jsxs(n.Fragment,{children:[n.jsx(z,{}),n.jsxs("div",{className:"admin-invoices-container",children:[n.jsx("h3",{children:"แก้ไขบิลแจ้งหนี้"}),n.jsxs("div",{style:{marginBottom:20},children:[n.jsx(u,{placeholder:"เลือกห้อง",onChange:A,style:{width:200,marginRight:10},children:["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"].map(e=>n.jsx(u.Option,{value:e,children:e},e))}),n.jsx(u,{placeholder:"เลือกปี",onChange:D,style:{width:200},children:Array.from(new Set(s.map(e=>e.year))).sort((e,t)=>t-e).map(e=>n.jsx(u.Option,{value:e,children:e+543},e))})]}),B?n.jsx(G,{}):n.jsx(H,{columns:Y,dataSource:L,rowKey:"id",pagination:!1})]}),n.jsx(T,{})]})};export{oe as default};
