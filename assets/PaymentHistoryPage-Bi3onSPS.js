import{r as a,j as e}from"./index-6khG2Yf5.js";import{e as k,c as w,F,j as M,l as C}from"./Footer-Cbq9hSoz.js";import{N as L,S as E,M as b}from"./Navbar--SWFEH57.js";import{F as v}from"./Table-CPSwFRZk.js";import{s as N}from"./index-BXCxonc7.js";import"./index-CQ6jledo.js";import"./Dropdown-WOv9cyra.js";import"./index-CMim-1d4.js";import"./index-CtH8D21f.js";import"./EyeOutlined-CmgoZAMV.js";const y={มกราคม:1,กุมภาพันธ์:2,มีนาคม:3,เมษายน:4,พฤษภาคม:5,มิถุนายน:6,กรกฎาคม:7,สิงหาคม:8,กันยายน:9,ตุลาคม:10,พฤศจิกายน:11,ธันวาคม:12},G=()=>{const[p,u]=a.useState([]),[h,n]=a.useState(!0),[x,i]=a.useState(null),[f,l]=a.useState(!1),c=k(),m=w();a.useEffect(()=>{(async()=>{n(!0);try{const r=m.currentUser;if(r){const I=r.uid,P=M(c,"payments"),d=(await C(P)).docs.map(s=>({id:s.id,...s.data()})).filter(s=>s.userId===I);d.sort((s,o)=>s.year===o.year?y[s.month]-y[o.month]:s.year-o.year),u(d)}}catch(r){console.error("Error fetching payment history: ",r),N.error("Failed to load payment history. Please try again.")}finally{n(!1)}})()},[c,m]);const g=t=>{i(t),l(!0)},S=()=>{l(!1),i(null)},j=[{title:"เดือน",dataIndex:"month",key:"month"},{title:"ปี",dataIndex:"year",key:"year",render:t=>t+543},{title:"ยอดรวม",dataIndex:"total",key:"total",render:t=>`${t} บาท`},{title:"ภาพหลักฐาน",dataIndex:"uploadedImage",key:"uploadedImage",render:t=>e.jsx("img",{src:t,alt:"Payment Slip",style:{width:"100px",cursor:"pointer"},onClick:()=>g(t)})},{title:"เวลา",dataIndex:"timestamp",key:"timestamp",render:t=>new Date(t.seconds*1e3).toLocaleString()},{title:"สถานะ",dataIndex:"roomStatus",key:"roomStatus",render:t=>e.jsx("span",{children:t==="จ่ายแล้ว"?"จ่ายแล้ว":"ค้างชำระ"})}];return e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsxs("div",{className:"payment-history-container",children:[e.jsx("h3",{children:"ประวัติการชำระเงิน"}),h?e.jsx(E,{size:"large"}):e.jsx(v,{dataSource:p,columns:j,rowKey:"id",pagination:!1}),e.jsx(b,{visible:f,footer:null,onCancel:S,centered:!0,width:600,children:e.jsx("img",{src:x||"",alt:"Payment Slip",style:{width:"100%"}})})]}),e.jsx(F,{})]})};export{G as default};
