import{p as c,L,q as n,N as V,aQ as p,S as N,aR as _,F as b,t as O,s as P,A as u,E as m,w as j,x as U,y as h,X as q}from"./index-DvTBtECc.js";const S={มกราคม:1,กุมภาพันธ์:2,มีนาคม:3,เมษายน:4,พฤษภาคม:5,มิถุนายน:6,กรกฎาคม:7,สิงหาคม:8,กันยายน:9,ตุลาคม:10,พฤศจิกายน:11,ธันวาคม:12},M=()=>{const[r,x]=c.useState([]),[I,y]=c.useState(!0),[f,k]=c.useState(void 0),[o,g]=c.useState({}),l=L();c.useEffect(()=>{(async()=>{y(!0);try{const t=O(l,"invoices"),d=(await P(t)).docs.map(s=>({id:s.id,...s.data()}));d.sort((s,v)=>{const A=S[s.month]||0,D=S[v.month]||0;return A-D||s.year-v.year}),x(d)}catch(t){console.error("Error fetching invoices data: ",t)}finally{y(!1)}})()},[l]);const i=async(e,t)=>{try{const a=j(l,"invoices",e);await U(a,t),h.success("ข้อมูลบิลได้ถูกแก้ไขเรียบร้อยแล้ว!");const d=r.map(s=>s.id===e?{...s,...t}:s);x(d),g(s=>({...s,[e]:!1}))}catch(a){console.error("Error updating invoice: ",a),h.error("เกิดข้อผิดพลาดในการแก้ไขข้อมูลบิล!")}},w=async e=>{try{const t=j(l,"invoices",e);await q(t),h.success("ข้อมูลบิลได้ถูกลบเรียบร้อยแล้ว!"),x(r.filter(a=>a.id!==e))}catch(t){console.error("Error deleting invoice: ",t),h.error("เกิดข้อผิดพลาดในการลบข้อมูลบิล!")}},E=e=>{k(e)},R=f?r.filter(e=>e.room===f):r,B=async(e,t)=>{await i(e,{roomStatus:t==="จ่ายแล้ว"?"ค้างชำระ":"จ่ายแล้ว"})},F=e=>{g(t=>({...t,[e]:!t[e]}))},C=[{title:"ห้อง",dataIndex:"room",key:"room"},{title:"เดือนที่แจ้งหนี้",dataIndex:"month",key:"month"},{title:"ปี (พ.ศ.)",dataIndex:"year",key:"year",render:e=>e+543},{title:"ค่าเช่า (บาท)",dataIndex:"rent",key:"rent",render:(e,t)=>o[t.id]?n.jsx(u,{defaultValue:e,onBlur:a=>i(t.id,{rent:a.target.value})}):n.jsx("span",{children:e})},{title:"ค่าน้ำ (บาท)",dataIndex:"water",key:"water",render:(e,t)=>o[t.id]?n.jsx(u,{defaultValue:e,onBlur:a=>i(t.id,{water:a.target.value})}):n.jsx("span",{children:e})},{title:"ค่าไฟ (บาท)",dataIndex:"electricity",key:"electricity",render:(e,t)=>o[t.id]?n.jsx(u,{defaultValue:e,onBlur:a=>i(t.id,{electricity:a.target.value})}):n.jsx("span",{children:e})},{title:"ค่าปรับ (บาท)",dataIndex:"fine",key:"fine",render:(e,t)=>o[t.id]?n.jsx(u,{defaultValue:e,onBlur:a=>i(t.id,{fine:a.target.value})}):n.jsx("span",{children:e})},{title:"ยอดรวม (บาท)",dataIndex:"total",key:"total"},{title:"สถานะห้อง",dataIndex:"roomStatus",key:"roomStatus",render:(e,t)=>n.jsxs(n.Fragment,{children:[n.jsx("span",{children:e}),n.jsx(m,{onClick:()=>B(t.id,e),style:{marginLeft:8},children:"เปลี่ยนสถานะ"})]})},{title:"ดาวน์โหลด PDF",dataIndex:"pdfUrl",key:"pdfUrl",render:e=>e?n.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:"ดาวน์โหลด"}):"ไม่มีไฟล์"},{title:"แก้ไข/บันทึก",key:"edit",render:(e,t)=>n.jsx(m,{onClick:()=>F(t.id),children:o[t.id]?"บันทึก":"แก้ไข"})},{title:"ลบ",key:"delete",render:(e,t)=>n.jsx(m,{onClick:()=>w(t.id),danger:!0,children:"ลบ"})}];return n.jsxs(n.Fragment,{children:[n.jsx(V,{}),n.jsxs("div",{className:"admin-invoices-container",children:[n.jsx("h3",{children:"แก้ไขบิลแจ้งหนี้"}),n.jsx(p,{placeholder:"เลือกห้อง",onChange:E,style:{width:200,marginBottom:20},children:Array.from(new Set(r.map(e=>e.room))).map(e=>n.jsx(p.Option,{value:e,children:e},e))}),I?n.jsx(N,{}):n.jsx(_,{dataSource:R,columns:C,rowKey:"id",pagination:!1})]}),n.jsx(b,{})]})};export{M as default};
