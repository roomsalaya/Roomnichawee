import{r,j as e}from"./index-Py8q0lCj.js";import{B as j,F as w,k as D,j as b,b as l,l as v,d as f,m as E}from"./Footer-czUV6VvL.js";import{N as L,S as $,L as d,M as C}from"./Navbar-C8zBjWdG.js";import{s as i}from"./index-BZVQ3A21.js";const U=()=>{const[o,c]=r.useState([]),[g,u]=r.useState(!0),[y,m]=r.useState(!1),[s,p]=r.useState(null);r.useEffect(()=>{(async()=>{u(!0);try{const n=(await D(b(l,"maintenanceReports"))).docs.map(x=>({id:x.id,...x.data()}));c(n)}catch(a){console.error("Error fetching maintenance reports:",a),i.error("เกิดข้อผิดพลาดในการดึงข้อมูล")}finally{u(!1)}})()},[]);const S=t=>{p(t),m(!0)},h=()=>{m(!1),p(null)},M=async t=>{try{await v(f(l,"maintenanceReports",t)),i.success("ลบรายการเรียบร้อย"),c(o.filter(a=>a.id!==t))}catch(a){console.error("Error deleting report:",a),i.error("เกิดข้อผิดพลาดในการลบรายการ")}finally{h()}},R=async t=>{if(!s)return;const a=s.status==="ซ่อมแซมแล้ว"?"รอดำเนินการ":"ซ่อมแซมแล้ว";try{await E(f(l,"maintenanceReports",t),{status:a}),i.success("อัปเดตสถานะเรียบร้อย"),c(o.map(n=>n.id===t?{...n,status:a}:n))}catch(n){console.error("Error updating status:",n),i.error("เกิดข้อผิดพลาดในการอัปเดตสถานะ")}};return e.jsxs("div",{className:"maintenance-list-wrapper",children:[" ",e.jsx(L,{}),e.jsxs("div",{className:"maintenance-list-container",children:[e.jsx("h3",{children:"รายการแจ้งซ่อมแซม"}),g?e.jsx("div",{className:"loading-container",children:e.jsx($,{size:"large"})}):e.jsx(d,{itemLayout:"vertical",size:"large",dataSource:o,renderItem:t=>e.jsxs(d.Item,{onClick:()=>S(t),style:{cursor:"pointer"},children:[e.jsx(d.Item.Meta,{title:`สถานที่: ${t.location}`}),e.jsx("p",{children:`รายละเอียด: ${t.issueDescription}`})]},t.id)})]}),e.jsx(C,{title:`รายละเอียดการแจ้งซ่อม: ${s==null?void 0:s.location}`,visible:y,onCancel:h,footer:null,children:s&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:`รายละเอียด: ${s.issueDescription}`}),s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:"ปัญหา",style:{maxWidth:"100%",maxHeight:"300px"}}),e.jsx("p",{children:`วันที่แจ้ง: ${new Date(s.timestamp.seconds*1e3).toLocaleString()}`}),e.jsx("p",{children:`สถานะ: ${s.status||"ยังไม่ได้ระบุ"}`}),e.jsx(j,{onClick:()=>R(s.id),style:{marginRight:"10px"},children:s.status==="ซ่อมแซมแล้ว"?"เปลี่ยนเป็นรอดำเนินการ":"เปลี่ยนเป็นซ่อมแซมแล้ว"}),e.jsx(j,{danger:!0,onClick:()=>M(s.id),children:"ลบรายการ"})]})}),e.jsx(w,{})]})};export{U as default};
