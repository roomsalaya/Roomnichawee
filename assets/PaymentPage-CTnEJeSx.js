import{r,j as e}from"./index-DgKVGHIq.js";import{I as T,_ as E,e as O,c as V,J as A,aa as _,B as p,F as q,j as u,k as I,r as J,at as Q,h as Y,i as b,au as G,av as K}from"./Footer-BggieqwG.js";import{N as W,b as X,S as Z,a as C}from"./Navbar-oRDaupqi.js";import{C as ee}from"./index-CkFSPcmI.js";import{U as se,R as te,a as ae}from"./index-C99Tukkx.js";import{s as n}from"./index-QF8AJRaD.js";import"./EyeOutlined-CISlUYWZ.js";import"./progress-DL7smSyT.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"},ne=function(h,a){return r.createElement(T,E({},h,{ref:a,icon:oe}))},re=r.forwardRef(ne);const{Option:ce}=C,N={มกราคม:1,กุมภาพันธ์:2,มีนาคม:3,เมษายน:4,พฤษภาคม:5,มิถุนายน:6,กรกฎาคม:7,สิงหาคม:8,กันยายน:9,ตุลาคม:10,พฤศจิกายน:11,ธันวาคม:12},fe=()=>{const[m,h]=r.useState([]),[a,y]=r.useState(null),[U,j]=r.useState(!0),[l,g]=r.useState(null),[R,S]=r.useState(!1),d=O(),f=V(),$=A();r.useEffect(()=>{(async()=>{j(!0);try{const t=f.currentUser;if(t){const c=t.email,x=(c==null?void 0:c.split("@")[0])||null,v=u(d,"invoices"),i=(await I(v)).docs.map(o=>({id:o.id,...o.data()})).filter(o=>o.room===x).sort((o,H)=>{const M=N[o.month],P=N[H.month];return M-P});h(i)}}catch(t){console.error("Error fetching invoices data: ",t),n.error("Failed to load invoices. Please try again.")}finally{j(!1)}})()},[d,f]);const F=s=>{const t=m.find(c=>c.id===s);y(t||null)},D=s=>{const t=new FileReader;return t.onloadend=()=>{g(t.result)},t.readAsDataURL(s),n.success(`${s.name} อัปโหลดเรียบร้อยแล้ว.`),!1},L=()=>{g(null),n.success("รูปภาพที่อัปโหลดถูกลบออก.")},k=s=>{navigator.clipboard.writeText(s).then(()=>{n.success("คัดลอกไปยังคลิปบอร์ดแล้ว!")}).catch(t=>{console.error("ไม่สามารถคัดลอกข้อความ: ",t)})},z=async()=>{var s;if(!a){n.error("โปรดเลือกใบแจ้งหนี้.");return}if(!l){n.error("โปรดแนบหลักฐานการชำระเงินก่อนกดส่ง.");return}S(!0);try{let t=null;if(l){const i=J($,`payments/${a.room}/${a.id}.png`);await Q(i,l,"data_url"),t=await Y(i)}const c={invoiceId:a.id,room:a.room,month:a.month,year:a.year,total:a.total,uploadedImage:t,userId:(s=f.currentUser)==null?void 0:s.uid,timestamp:new Date},x=u(d,"payments");await b(x,c);const v=G(u(d,"users"),K("role","==","admin")),w=(await I(v)).docs.map(i=>{const o={message:`ชำระเงินใหม่ส่งโดยห้อง ${a.room} สำหรับ ${a.month}`,userId:i.id,read:!1,timestamp:new Date};return b(u(d,"notifications"),o)});await Promise.all(w),n.success("ส่งข้อมูลการชำระเงินเรียบร้อยแล้ว!"),g(null),y(null)}catch(t){console.error("เกิดข้อผิดพลาดในการส่งข้อมูลการชำระเงิน: ",t),n.error("ส่งข้อมูลการชำระเงินไม่สำเร็จ โปรดลองอีกครั้ง")}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsxs("div",{className:"payment-container",children:[e.jsx("h3",{children:"ส่งหลักฐานการโอน"}),e.jsxs(X,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(ee,{className:"payment-card",title:"บัญชีสำหรับชำระหนี้",children:[e.jsxs("p",{className:"scb",children:[e.jsx("img",{src:"https://img5.pic.in.th/file/secure-sv1/unnamed4edf9fa04b6e50f3.png",alt:"Bank Logo",className:"logo-image"}),"  ธนาคารไทยพาณิชย์"]}),e.jsx("p",{className:"scb",children:"ชื่อบัญชี : ณัชชา นุ่มสันต์"}),e.jsxs("p",{className:"bum",children:["เลขบัญชี : 131-2-01-973-3  ",e.jsx(_,{title:"คัดลอกหมายเลขบัญชี",children:e.jsx(p,{shape:"circle",icon:e.jsx(re,{}),onClick:()=>k("1312019733"),className:"copy-button"})})]}),e.jsx("p",{className:"scb1",children:"กำหนดชำระล่าช้าไม่เกินวันที่ 5 ของเดือนถัดไป"})]}),U?e.jsx(Z,{size:"large"}):e.jsx(e.Fragment,{children:m.length>0?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"custom-select",style:{width:300,marginBottom:20},placeholder:"เลือกบิล",onChange:F,value:(a==null?void 0:a.id)||void 0,children:m.filter(s=>s.year===new Date().getFullYear()).map(s=>e.jsx(ce,{value:s.id,children:`${s.month} (ยอด: ${s.total} บาท, ${s.roomStatus})`},s.id))}),a&&e.jsxs(e.Fragment,{children:[e.jsx(se,{beforeUpload:D,showUploadList:!1,children:e.jsx(p,{type:"dashed",icon:e.jsx(te,{}),style:{marginTop:10},children:"แนบสลิปเงิน"})}),l&&e.jsxs("div",{className:"image-preview",children:[e.jsx("img",{src:l,alt:"Uploaded Slip",className:"uploaded-image"}),e.jsx(p,{icon:e.jsx(ae,{}),onClick:L,type:"link",danger:!0,children:"ลบรูป"})]}),e.jsx(p,{type:"primary",onClick:z,loading:R,style:{marginTop:20},children:"ส่งหลักฐานการชำระเงิน"})]})]}):e.jsx("p",{children:"ไม่พบบิลที่ต้องชำระ"})})]})]}),e.jsx(q,{})]})};export{fe as default};
