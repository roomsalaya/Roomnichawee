import{u as I,r as u,j as e}from"./index-BWJa64qi.js";import{q as m,p as f,w as b,F as V,X as R}from"./Footer-stKjf6O3.js";import{N as A}from"./Navbar-DmkU5xNr.js";const k=p=>{const n=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],d=n.indexOf(p);return d>0?n[d-1]:n[n.length-1]},q=()=>{const p=I(),[n,d]=u.useState("มกราคม"),[i,D]=u.useState("2567"),[l,h]=u.useState({});u.useEffect(()=>{E(n,i)},[n,i]);const N=t=>{d(t.target.value)},S=t=>{D(t.target.value)},E=async(t,a)=>{const r=`${t} ${a}`;try{const c=m(f,"electricityData",r),s=await b(c);if(s.exists()){const o=s.data();h(x=>({...x,...o}))}else{const o=M();h(o)}}catch(c){console.error("Error fetching data: ",c)}},M=()=>["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"].reduce((a,r)=>(a[r]={previous:"0",current:"0",units:"0",amount:"0"},a),{}),C=async(t,a)=>{const c=`${k(t)} ${a}`;try{const s=m(f,"electricityData",c),o=await b(s);if(o.exists()){const x=o.data();h(Y=>{const j={...Y};for(const v in x)j[v]={...j[v],previous:x[v].current};return j})}}catch(s){console.error("Error fetching previous month data: ",s)}};u.useEffect(()=>{n!=="มกราคม"&&C(n,i)},[n,i]);const $=async()=>{const t=`${n} ${i}`;try{const a={roomData:l};await R(m(f,"electricityData",t),a),alert("Data saved successfully!")}catch(a){console.error("Error saving data: ",a),alert("Failed to save data.")}},g=(t,a,r)=>{h(c=>{const s={...c,[t]:{...c[t],[a]:r}};return(a==="previous"||a==="current")&&(s[t].units=w(s[t].previous,s[t].current),s[t].amount=y(s[t].units)),a==="units"&&(s[t].amount=y(r)),s})},w=(t,a)=>{const r=parseInt(t,10)||0,s=(parseInt(a,10)||0)-r;return Math.max(s,0).toString()},y=t=>((parseInt(t,10)||0)*9).toString(),F=()=>Object.values(l).reduce((t,a)=>t+parseFloat(a.amount||"0"),0);return e.jsxs(e.Fragment,{children:[e.jsx(A,{}),e.jsxs("div",{className:"electricityrate-container",children:[e.jsxs("div",{className:"electricityrate",children:[e.jsx("h3",{children:"เลือกรอบจดมิเตอร์ไฟฟ้า"}),e.jsxs("div",{className:"dropdown",children:[e.jsx("select",{className:"form-select","aria-label":"เลือกเดือน",value:n,onChange:N,children:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"].map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("select",{className:"form-select","aria-label":"เลือกปี",value:i,onChange:S,children:Array.from({length:10},(t,a)=>2567+a).map(t=>e.jsx("option",{value:t.toString(),children:t},t))})]})]}),e.jsx("div",{className:"electricityrate-dropdown",children:e.jsx("h3",{children:`${n} ${i}`})}),e.jsxs("div",{className:"table-container",children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ห้องพัก"}),e.jsx("th",{children:"เลขก่อนหน้า"}),e.jsx("th",{children:"เลขล่าสุด"}),e.jsx("th",{children:"หน่วยที่ใช้"}),e.jsx("th",{children:"จำนวนเงิน"})]})}),e.jsx("tbody",{children:["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"].map(t=>{var a,r,c,s;return e.jsxs("tr",{children:[e.jsx("td",{children:t}),e.jsx("td",{children:e.jsx("input",{type:"number",value:(a=l[t])==null?void 0:a.previous,onChange:o=>g(t,"previous",o.target.value),placeholder:"เลขก่อนหน้า"})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:(r=l[t])==null?void 0:r.current,onChange:o=>g(t,"current",o.target.value),placeholder:"เลขล่าสุด"})}),e.jsx("td",{children:(c=l[t])==null?void 0:c.units}),e.jsx("td",{children:(s=l[t])==null?void 0:s.amount})]},t)})})]}),e.jsxs("h4",{children:["รวมจำนวนเงิน: ",F()," บาท"]}),e.jsx("button",{onClick:$,className:"btn btn-primary",children:"บันทึกข้อมูล"})]}),e.jsx("button",{onClick:()=>p("/Showelectricity"),className:"btn btn-secondary",children:"ดูการใช้ไฟฟ้า"}),e.jsx(V,{})]})]})};export{q as default};
