import{r as m,j as r}from"./index-Py8q0lCj.js";import{o as ae,p as J,q as ie,t as Q,v as B,_ as oe,K as U,w as ce,x as re,y as D,z as le,A as se,T as de,D as he,E as ue,G as me,W as ge,H as pe,e as Se,J as fe,F as $e,j as X,k as Ce,d as K,g as be,r as we,u as Ie,h as ve,n as G}from"./Footer-czUV6VvL.js";import{N as xe,S as ye,M as ke}from"./Navbar-C8zBjWdG.js";import{F as x}from"./index-qVXDYOA_.js";import{C as Me}from"./index-DU8c37Pb.js";import{I as q}from"./index-C5esm8xC.js";import{s as Y}from"./index-BZVQ3A21.js";import"./EyeOutlined-Bbd6VZT9.js";var je=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],Z=m.forwardRef(function(e,n){var i,o=e.prefixCls,d=o===void 0?"rc-switch":o,u=e.className,p=e.checked,c=e.defaultChecked,a=e.disabled,s=e.loadingIcon,h=e.checkedChildren,b=e.unCheckedChildren,S=e.onClick,C=e.onChange,k=e.onKeyDown,H=ae(e,je),E=J(!1,{value:p,defaultValue:c}),M=ie(E,2),v=M[0],f=M[1];function F($,z){var j=v;return a||(j=$,f(j),C==null||C(j,z)),j}function N($){$.which===U.LEFT?F(!1,$):$.which===U.RIGHT&&F(!0,$),k==null||k($)}function w($){var z=F(!v,$);S==null||S(z,$)}var O=Q(d,u,(i={},B(i,"".concat(d,"-checked"),v),B(i,"".concat(d,"-disabled"),a),i));return m.createElement("button",oe({},H,{type:"button",role:"switch","aria-checked":v,disabled:a,className:O,ref:n,onKeyDown:N,onClick:w}),s,m.createElement("span",{className:"".concat(d,"-inner")},m.createElement("span",{className:"".concat(d,"-inner-checked")},h),m.createElement("span",{className:"".concat(d,"-inner-unchecked")},b)))});Z.displayName="Switch";const De=e=>{const{componentCls:n,trackHeightSM:i,trackPadding:o,trackMinWidthSM:d,innerMinMarginSM:u,innerMaxMarginSM:p,handleSizeSM:c,calc:a}=e,s=`${n}-inner`,h=D(a(c).add(a(o).mul(2)).equal()),b=D(a(p).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:d,height:i,lineHeight:D(i),[`${n}-inner`]:{paddingInlineStart:p,paddingInlineEnd:u,[`${s}-checked, ${s}-unchecked`]:{minHeight:i},[`${s}-checked`]:{marginInlineStart:`calc(-100% + ${h} - ${b})`,marginInlineEnd:`calc(100% - ${h} + ${b})`},[`${s}-unchecked`]:{marginTop:a(i).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:c,height:c},[`${n}-loading-icon`]:{top:a(a(c).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:u,paddingInlineEnd:p,[`${s}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${s}-unchecked`]:{marginInlineStart:`calc(100% - ${h} + ${b})`,marginInlineEnd:`calc(-100% + ${h} - ${b})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${D(a(c).add(o).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${s}`]:{[`${s}-unchecked`]:{marginInlineStart:a(e.marginXXS).div(2).equal(),marginInlineEnd:a(e.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${s}`]:{[`${s}-checked`]:{marginInlineStart:a(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:a(e.marginXXS).div(2).equal()}}}}}}},Ee=e=>{const{componentCls:n,handleSize:i,calc:o}=e;return{[n]:{[`${n}-loading-icon${e.iconCls}`]:{position:"relative",top:o(o(i).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:e.switchColor}}}},Fe=e=>{const{componentCls:n,trackPadding:i,handleBg:o,handleShadow:d,handleSize:u,calc:p}=e,c=`${n}-handle`;return{[n]:{[c]:{position:"absolute",top:i,insetInlineStart:i,width:u,height:u,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:o,borderRadius:p(u).div(2).equal(),boxShadow:d,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${c}`]:{insetInlineStart:`calc(100% - ${D(p(u).add(i).equal())})`},[`&:not(${n}-disabled):active`]:{[`${c}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${c}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},Ne=e=>{const{componentCls:n,trackHeight:i,trackPadding:o,innerMinMargin:d,innerMaxMargin:u,handleSize:p,calc:c}=e,a=`${n}-inner`,s=D(c(p).add(c(o).mul(2)).equal()),h=D(c(u).mul(2).equal());return{[n]:{[a]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:u,paddingInlineEnd:d,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${a}-checked, ${a}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:i},[`${a}-checked`]:{marginInlineStart:`calc(-100% + ${s} - ${h})`,marginInlineEnd:`calc(100% - ${s} + ${h})`},[`${a}-unchecked`]:{marginTop:c(i).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${a}`]:{paddingInlineStart:d,paddingInlineEnd:u,[`${a}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${a}-unchecked`]:{marginInlineStart:`calc(100% - ${s} + ${h})`,marginInlineEnd:`calc(-100% + ${s} - ${h})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${a}`]:{[`${a}-unchecked`]:{marginInlineStart:c(o).mul(2).equal(),marginInlineEnd:c(o).mul(-1).mul(2).equal()}},[`&${n}-checked ${a}`]:{[`${a}-checked`]:{marginInlineStart:c(o).mul(-1).mul(2).equal(),marginInlineEnd:c(o).mul(2).equal()}}}}}},ze=e=>{const{componentCls:n,trackHeight:i,trackMinWidth:o}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},le(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:o,height:i,lineHeight:D(i),verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:e.colorTextTertiary}}),se(e)),{[`&${n}-checked`]:{background:e.switchColor,[`&:hover:not(${n}-disabled)`]:{background:e.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},qe=e=>{const{fontSize:n,lineHeight:i,controlHeight:o,colorWhite:d}=e,u=n*i,p=o/2,c=2,a=u-c*2,s=p-c*2;return{trackHeight:u,trackHeightSM:p,trackMinWidth:a*2+c*4,trackMinWidthSM:s*2+c*2,trackPadding:c,handleBg:d,handleSize:a,handleSizeSM:s,handleShadow:`0 2px 4px 0 ${new de("#00230b").setAlpha(.2).toRgbString()}`,innerMinMargin:a/2,innerMaxMargin:a+c+c*2,innerMinMarginSM:s/2,innerMaxMarginSM:s+c+c*2}},He=ce("Switch",e=>{const n=re(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[ze(n),Ne(n),Fe(n),Ee(n),De(n)]},qe);var Oe=function(e,n){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(i[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,o=Object.getOwnPropertySymbols(e);d<o.length;d++)n.indexOf(o[d])<0&&Object.prototype.propertyIsEnumerable.call(e,o[d])&&(i[o[d]]=e[o[d]]);return i};const Pe=m.forwardRef((e,n)=>{const{prefixCls:i,size:o,disabled:d,loading:u,className:p,rootClassName:c,style:a,checked:s,value:h,defaultChecked:b,defaultValue:S,onChange:C}=e,k=Oe(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[H,E]=J(!1,{value:s??h,defaultValue:b??S}),{getPrefixCls:M,direction:v,switch:f}=m.useContext(he),F=m.useContext(ue),N=(d??F)||u,w=M("switch",i),O=m.createElement("div",{className:`${w}-handle`},u&&m.createElement(pe,{className:`${w}-loading-icon`})),[$,z,j]=He(w),A=me(o),R=Q(f==null?void 0:f.className,{[`${w}-small`]:A==="small",[`${w}-loading`]:u,[`${w}-rtl`]:v==="rtl"},p,c,z,j),P=Object.assign(Object.assign({},f==null?void 0:f.style),a),V=function(){E(arguments.length<=0?void 0:arguments[0]),C==null||C.apply(void 0,arguments)};return $(m.createElement(ge,{component:"Switch"},m.createElement(Z,Object.assign({},k,{checked:H,onChange:V,prefixCls:w,className:R,style:P,disabled:N,ref:n,loadingIcon:O}))))}),ee=Pe;ee.__ANT_SWITCH=!0;const Ye=()=>{var _;const[e,n]=m.useState("มกราคม"),[i,o]=m.useState(new Date().getFullYear()),[d,u]=m.useState(!1),[p,c]=m.useState([]),[a,s]=m.useState(!0),[h,b]=m.useState(null),[S]=x.useForm(),[C,k]=m.useState({}),[H,E]=m.useState(0),[M,v]=m.useState(null),f=Se(),F=fe(),N=["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"];m.useEffect(()=>{(async()=>{s(!0);try{const l=X(f,"users"),I=(await Ce(l)).docs.map(y=>({id:y.id,...y.data()}));c(I)}catch(l){console.error("Error fetching users data: ",l)}finally{s(!1)}})()},[f]),m.useEffect(()=>{(async()=>{const l=i+543,g=`${e} ${l}`;try{const I=K(f,"electricityData",g),y=await be(I);y.exists()?k(y.data()):(console.log("No electricity data found for the selected month and year."),k(w()))}catch(I){console.error("Error fetching electricity data: ",I)}})()},[e,i,f]);const w=()=>N.reduce((l,g)=>(l[g]={previous:"0",current:"0",units:"0",amount:"0"},l),{}),O=t=>{n(t.target.value)},$=t=>{o(Number(t.target.value))},z=()=>{u(!1),S.resetFields(),E(0),v(null)},j=t=>{var g;const l=(g=t.target.files)==null?void 0:g[0];l&&l.type==="application/pdf"?v(l):Y.error("กรุณาเลือกไฟล์ PDF เท่านั้น")},A=async()=>{var t;try{let l="";if(M){const T=we(F,`invoices/${M.name}`);await Ie(T,M),l=await ve(T)}const g={userId:h.id,room:h.room||"ไม่ระบุ",month:e,year:i,rent:S.getFieldValue("rent"),water:S.getFieldValue("water"),electricity:((t=C[h.room])==null?void 0:t.amount)||"ไม่ระบุ",fine:S.getFieldValue("fine"),total:H,roomStatus:S.getFieldValue("roomStatus")?"จ่ายแล้ว":"ค้างชำระ",pdfUrl:l},I=K(X(f,"invoices"));await G(I,g);const y={userId:h.id,message:`ใบแจ้งหนี้ห้อง ${h.room} ประจำเดือน ${e} ${i}`,timestamp:new Date,status:"unread"},L=K(X(f,"notifications"));await G(L,y),Y.success("บิลแจ้งหนี้ถูกส่งและแจ้งเตือนผู้ใช้งานเรียบร้อยแล้ว!"),u(!1),S.resetFields(),E(0),v(null)}catch(l){console.error("Error saving invoice data or sending notification: ",l),Y.error("เกิดข้อผิดพลาดในการส่งบิลแจ้งหนี้หรือการแจ้งเตือน")}},R=t=>{var l,g;b(t),S.setFieldsValue({room:t.room||"ไม่ระบุ",rent:t.rent||"",water:t.water||"",electricity:((l=C[t.room])==null?void 0:l.amount)||"ไม่ระบุ",fine:"",roomStatus:t.roomStatus||!1,total:`${P(t.rent,t.water,(g=C[t.room])==null?void 0:g.amount)}`}),u(!0)},P=(t,l,g,I="0")=>{const y=parseFloat(t||"0"),L=parseFloat(l||"0"),T=parseFloat(g||"0"),te=parseFloat(I||"0"),W=y+L+T+te;return E(W),S.setFieldsValue({total:`${W}`}),W},V=(t,l)=>{var g;P(l.rent,l.water,(g=C[h==null?void 0:h.room])==null?void 0:g.amount,l.fine)},ne=p.sort((t,l)=>{const g=N.indexOf(t.room),I=N.indexOf(l.room);return g-I});return r.jsxs(r.Fragment,{children:[r.jsx(xe,{}),r.jsxs("div",{className:"invoice-form-container",children:[r.jsx("h3",{children:"เลือกรอบบิล"}),r.jsx("select",{className:"form-select","aria-label":"เลือกเดือน",value:e,onChange:O,children:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"].map(t=>r.jsx("option",{value:t,children:t},t))}),r.jsx("select",{className:"form-select","aria-label":"เลือกปี",value:i,onChange:$,children:Array.from({length:10},(t,l)=>new Date().getFullYear()+l).map(t=>r.jsx("option",{value:t.toString(),children:t},t))}),a?r.jsx(ye,{size:"large"}):r.jsx("div",{className:"cards-container",children:ne.map(t=>r.jsxs(Me,{title:`ห้อง: ${t.room||"ไม่ระบุ"}`,bordered:!0,style:{width:300,marginTop:16,cursor:"pointer"},onClick:()=>R(t),children:[r.jsxs("p",{children:["ค่าเช่า: ",t.rent]}),r.jsxs("p",{children:["ค่าน้ำ: ",t.water]})]},t.id))}),r.jsx(ke,{title:`ออกใบแจ้งหนี้ห้อง ${(h==null?void 0:h.room)||"ไม่ระบุ"}`,visible:d,onCancel:z,onOk:A,okText:"ส่งบิล",children:r.jsxs(x,{form:S,onValuesChange:V,children:[r.jsx(x.Item,{name:"room",label:"ห้อง",children:r.jsx(q,{disabled:!0})}),r.jsx(x.Item,{name:"rent",label:"ค่าเช่า",rules:[{required:!0,message:"กรุณากรอกค่าเช่า"}],children:r.jsx(q,{type:"number"})}),r.jsx(x.Item,{name:"water",label:"ค่าน้ำ",rules:[{required:!0,message:"กรุณากรอกค่าน้ำ"}],children:r.jsx(q,{type:"number"})}),r.jsx(x.Item,{name:"electricity",label:"ค่าไฟ",children:r.jsx(q,{value:((_=C[h==null?void 0:h.room])==null?void 0:_.amount)||"ไม่ระบุ",disabled:!0})}),r.jsx(x.Item,{name:"fine",label:"ค่าปรับ",children:r.jsx(q,{type:"number"})}),r.jsx(x.Item,{name:"roomStatus",label:"สถานะห้อง",children:r.jsx(ee,{checkedChildren:"จ่ายแล้ว",unCheckedChildren:"ค้างชำระ"})}),r.jsx(x.Item,{name:"total",label:"รวม",children:r.jsx(q,{disabled:!0})}),r.jsx(x.Item,{label:"ไฟล์ PDF",children:r.jsx("input",{type:"file",accept:"application/pdf",onChange:j})})]})})]}),r.jsx($e,{})]})};export{Ye as default};
