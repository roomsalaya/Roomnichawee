import{p as h,w as m,v as f,J as D,q as e,N as Y,F as I,ab as V}from"./index-D6uzPFSQ.js";const O=o=>{const u=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],i=u.indexOf(o);return i>0?u[i-1]:u[u.length-1]},A=()=>{const[o,u]=h.useState("มกราคม"),[i,b]=h.useState("2567"),[d,x]=h.useState({});h.useEffect(()=>{E(o,i)},[o,i]);const N=t=>{u(t.target.value)},S=t=>{b(t.target.value)},E=async(t,n)=>{const a=`${t} ${n}`;try{const r=m(f,"electricityData",a),s=await D(r);if(s.exists()){const c=s.data();x(p=>{const j={...p};for(const l in c)j[l]={previous:c[l].previous||"0",current:c[l].current||"0",units:c[l].units||"0",amount:c[l].amount||"0"};return j})}else{const c=M();x(c)}}catch(r){console.error("Error fetching data: ",r)}},M=()=>["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"].reduce((n,a)=>(n[a]={previous:"0",current:"0",units:"0",amount:"0"},n),{}),$=async(t,n)=>{const r=`${O(t)} ${n}`;try{const s=m(f,"electricityData",r),c=await D(s);if(c.exists()){const p=c.data();x(j=>{const l={...j};for(const v in p)l[v]={...l[v],previous:p[v].current};return l})}}catch(s){console.error("Error fetching previous month data: ",s)}};h.useEffect(()=>{o!=="มกราคม"&&$(o,i)},[o,i]);const C=async()=>{const t=`${o} ${i}`;try{const n=Object.fromEntries(Object.entries(d).map(([a,r])=>[a,{previous:r.previous||"0",current:r.current||"0",units:r.units||"0",amount:r.amount||"0"}]));console.log("Saving data to Firestore: ",n),await V(m(f,"electricityData",t),n),alert("บันทึกสำเร็จ")}catch(n){console.error("บันทึกไม่สำเร็จ: ",n),alert("บันทึกไม่สำเร็จ.")}},g=(t,n,a)=>{x(r=>{const s={...r,[t]:{...r[t],[n]:a}};return(n==="previous"||n==="current")&&(s[t].units=w(s[t].previous,s[t].current),s[t].amount=y(s[t].units)),n==="units"&&(s[t].amount=y(a)),s})},w=(t,n)=>{const a=parseInt(t,10)||0,s=(parseInt(n,10)||0)-a;return Math.max(s,0).toString()},y=t=>((parseInt(t,10)||0)*9).toString(),F=()=>Object.values(d).reduce((t,n)=>t+parseFloat(n.amount||"0"),0);return e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsxs("div",{className:"electricityrate-container",children:[e.jsxs("div",{className:"electricityrate",children:[e.jsx("h3",{children:"เลือกรอบจดมิเตอร์ไฟฟ้า"}),e.jsxs("div",{className:"dropdown",children:[e.jsx("select",{className:"form-select","aria-label":"เลือกเดือน",value:o,onChange:N,children:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"].map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("select",{className:"form-select","aria-label":"เลือกปี",value:i,onChange:S,children:Array.from({length:6},(t,n)=>2567+n).map(t=>e.jsx("option",{value:t.toString(),children:t},t))})]})]}),e.jsx("div",{className:"electricityrate-dropdown",children:e.jsx("h3",{children:`${o} ${i}`})}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ห้องพัก"}),e.jsx("th",{children:"เลขก่อนหน้า"}),e.jsx("th",{children:"เลขล่าสุด"}),e.jsx("th",{children:"หน่วยที่ใช้"}),e.jsx("th",{children:"จำนวนเงิน"})]})}),e.jsx("tbody",{children:["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"].map(t=>{var n,a,r,s;return e.jsxs("tr",{children:[e.jsx("td",{children:t}),e.jsx("td",{children:e.jsx("input",{type:"text",value:((n=d[t])==null?void 0:n.previous)||"",onChange:c=>g(t,"previous",c.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:((a=d[t])==null?void 0:a.current)||"",onChange:c=>g(t,"current",c.target.value)})}),e.jsx("td",{children:((r=d[t])==null?void 0:r.units)||""}),e.jsx("td",{children:((s=d[t])==null?void 0:s.amount)||""})]},t)})})]})}),e.jsx("button",{onClick:C,children:"บันทึกข้อมูล"}),e.jsx("div",{className:"total-amount",children:e.jsx("strong",{children:`จำนวนเงินทั้งหมด: ${F()} บาท`})})]}),e.jsx(I,{})]})};export{A as default};
