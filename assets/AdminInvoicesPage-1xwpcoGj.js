import{r as c,j as n}from"./index-Cmh9xFDU.js";import{y as A,F as L,o as N,n as _,B as f,q as v,s as b,W as O}from"./Footer-CeENDa52.js";import{N as P,e as j,S as U}from"./Navbar-CUWQJ0m4.js";import{F as q}from"./Table-Ch7ovp3L.js";import{I as m}from"./index-BrQnweTm.js";import{s as u}from"./index-DWr8MVPN.js";import"./index-B3DvRhKG.js";import"./Dropdown-DiFyNEDR.js";const I={มกราคม:1,กุมภาพันธ์:2,มีนาคม:3,เมษายน:4,พฤษภาคม:5,มิถุนายน:6,กรกฎาคม:7,สิงหาคม:8,กันยายน:9,ตุลาคม:10,พฤศจิกายน:11,ธันวาคม:12},Q=()=>{const[s,h]=c.useState([]),[S,x]=c.useState(!0),[y,k]=c.useState(void 0),[a,p]=c.useState({}),l=A();c.useEffect(()=>{(async()=>{x(!0);try{const t=N(l,"invoices"),d=(await _(t)).docs.map(o=>({id:o.id,...o.data()}));d.sort((o,g)=>{const D=I[o.month]||0,V=I[g.month]||0;return D-V||o.year-g.year}),h(d)}catch(t){console.error("Error fetching invoices data: ",t)}finally{x(!1)}})()},[l]);const i=async(e,t)=>{try{const r=v(l,"invoices",e);await b(r,t),u.success("ข้อมูลบิลได้ถูกแก้ไขเรียบร้อยแล้ว!");const d=s.map(o=>o.id===e?{...o,...t}:o);h(d),p(o=>({...o,[e]:!1}))}catch(r){console.error("Error updating invoice: ",r),u.error("เกิดข้อผิดพลาดในการแก้ไขข้อมูลบิล!")}},w=async e=>{try{const t=v(l,"invoices",e);await O(t),u.success("ข้อมูลบิลได้ถูกลบเรียบร้อยแล้ว!"),h(s.filter(r=>r.id!==e))}catch(t){console.error("Error deleting invoice: ",t),u.error("เกิดข้อผิดพลาดในการลบข้อมูลบิล!")}},E=e=>{k(e)},B=y?s.filter(e=>e.room===y):s,F=async(e,t)=>{await i(e,{roomStatus:t==="จ่ายแล้ว"?"ค้างชำระ":"จ่ายแล้ว"})},R=e=>{p(t=>({...t,[e]:!t[e]}))},C=[{title:"ห้อง",dataIndex:"room",key:"room"},{title:"เดือนที่แจ้งหนี้",dataIndex:"month",key:"month"},{title:"ปี (พ.ศ.)",dataIndex:"year",key:"year",render:e=>e+543},{title:"ค่าเช่า (บาท)",dataIndex:"rent",key:"rent",render:(e,t)=>a[t.id]?n.jsx(m,{defaultValue:e,onBlur:r=>i(t.id,{rent:r.target.value})}):n.jsx("span",{children:e})},{title:"ค่าน้ำ (บาท)",dataIndex:"water",key:"water",render:(e,t)=>a[t.id]?n.jsx(m,{defaultValue:e,onBlur:r=>i(t.id,{water:r.target.value})}):n.jsx("span",{children:e})},{title:"ค่าไฟ (บาท)",dataIndex:"electricity",key:"electricity",render:(e,t)=>a[t.id]?n.jsx(m,{defaultValue:e,onBlur:r=>i(t.id,{electricity:r.target.value})}):n.jsx("span",{children:e})},{title:"ค่าปรับ (บาท)",dataIndex:"fine",key:"fine",render:(e,t)=>a[t.id]?n.jsx(m,{defaultValue:e,onBlur:r=>i(t.id,{fine:r.target.value})}):n.jsx("span",{children:e})},{title:"ยอดรวม (บาท)",dataIndex:"total",key:"total"},{title:"สถานะห้อง",dataIndex:"roomStatus",key:"roomStatus",render:(e,t)=>n.jsxs(n.Fragment,{children:[n.jsx("span",{children:e}),n.jsx(f,{onClick:()=>F(t.id,e),style:{marginLeft:8},children:"เปลี่ยนสถานะ"})]})},{title:"ดาวน์โหลด PDF",dataIndex:"pdfUrl",key:"pdfUrl",render:e=>e?n.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:"ดาวน์โหลด"}):"ไม่มีไฟล์"},{title:"แก้ไข/บันทึก",key:"edit",render:(e,t)=>n.jsx(f,{onClick:()=>R(t.id),children:a[t.id]?"บันทึก":"แก้ไข"})},{title:"ลบ",key:"delete",render:(e,t)=>n.jsx(f,{onClick:()=>w(t.id),danger:!0,children:"ลบ"})}];return n.jsxs(n.Fragment,{children:[n.jsx(P,{}),n.jsxs("div",{className:"admin-invoices-container",children:[n.jsx("h3",{children:"แก้ไขบิลแจ้งหนี้"}),n.jsx(j,{placeholder:"เลือกห้อง",onChange:E,style:{width:200,marginBottom:20},children:Array.from(new Set(s.map(e=>e.room))).map(e=>n.jsx(j.Option,{value:e,children:e},e))}),S?n.jsx(U,{}):n.jsx(q,{dataSource:B,columns:C,rowKey:"id",pagination:!1})]}),n.jsx(L,{})]})};export{Q as default};
