import{p as m,m as te,a0 as B,a1 as ae,d as U,f as X,c as ie,a2 as Y,o as le,a3 as oe,u as E,r as ce,a4 as re,a5 as se,C as de,a6 as he,a7 as ue,a8 as me,a9 as ge,L as Se,aa as pe,q as c,N as fe,S as $e,Y as Ce,A as q,F as be,t as K,s as we,w as _,J as Ie,y as R,M as ve,P as xe,Q as ye,$ as ke}from"./index-C3gF8JJM.js";import{F as y}from"./index-DqkIj1Zi.js";import{C as Me}from"./index-bZf0xGYH.js";var je=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],Q=m.forwardRef(function(e,n){var o,i=e.prefixCls,d=i===void 0?"rc-switch":i,u=e.className,S=e.checked,l=e.defaultChecked,a=e.disabled,s=e.loadingIcon,h=e.checkedChildren,b=e.unCheckedChildren,p=e.onClick,C=e.onChange,k=e.onKeyDown,P=te(e,je),D=B(!1,{value:S,defaultValue:l}),M=ae(D,2),v=M[0],f=M[1];function F($,z){var j=v;return a||(j=$,f(j),C==null||C(j,z)),j}function N($){$.which===Y.LEFT?F(!1,$):$.which===Y.RIGHT&&F(!0,$),k==null||k($)}function w($){var z=F(!v,$);p==null||p(z,$)}var H=U(d,u,(o={},X(o,"".concat(d,"-checked"),v),X(o,"".concat(d,"-disabled"),a),o));return m.createElement("button",ie({},P,{type:"button",role:"switch","aria-checked":v,disabled:a,className:H,ref:n,onKeyDown:N,onClick:w}),s,m.createElement("span",{className:"".concat(d,"-inner")},m.createElement("span",{className:"".concat(d,"-inner-checked")},h),m.createElement("span",{className:"".concat(d,"-inner-unchecked")},b)))});Q.displayName="Switch";const Ee=e=>{const{componentCls:n,trackHeightSM:o,trackPadding:i,trackMinWidthSM:d,innerMinMarginSM:u,innerMaxMarginSM:S,handleSizeSM:l,calc:a}=e,s=`${n}-inner`,h=E(a(l).add(a(i).mul(2)).equal()),b=E(a(S).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:d,height:o,lineHeight:E(o),[`${n}-inner`]:{paddingInlineStart:S,paddingInlineEnd:u,[`${s}-checked, ${s}-unchecked`]:{minHeight:o},[`${s}-checked`]:{marginInlineStart:`calc(-100% + ${h} - ${b})`,marginInlineEnd:`calc(100% - ${h} + ${b})`},[`${s}-unchecked`]:{marginTop:a(o).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:l,height:l},[`${n}-loading-icon`]:{top:a(a(l).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:u,paddingInlineEnd:S,[`${s}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${s}-unchecked`]:{marginInlineStart:`calc(100% - ${h} + ${b})`,marginInlineEnd:`calc(-100% + ${h} - ${b})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${E(a(l).add(i).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${s}`]:{[`${s}-unchecked`]:{marginInlineStart:a(e.marginXXS).div(2).equal(),marginInlineEnd:a(e.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${s}`]:{[`${s}-checked`]:{marginInlineStart:a(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:a(e.marginXXS).div(2).equal()}}}}}}},De=e=>{const{componentCls:n,handleSize:o,calc:i}=e;return{[n]:{[`${n}-loading-icon${e.iconCls}`]:{position:"relative",top:i(i(o).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:e.switchColor}}}},Fe=e=>{const{componentCls:n,trackPadding:o,handleBg:i,handleShadow:d,handleSize:u,calc:S}=e,l=`${n}-handle`;return{[n]:{[l]:{position:"absolute",top:o,insetInlineStart:o,width:u,height:u,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:i,borderRadius:S(u).div(2).equal(),boxShadow:d,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${l}`]:{insetInlineStart:`calc(100% - ${E(S(u).add(o).equal())})`},[`&:not(${n}-disabled):active`]:{[`${l}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${l}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},Ne=e=>{const{componentCls:n,trackHeight:o,trackPadding:i,innerMinMargin:d,innerMaxMargin:u,handleSize:S,calc:l}=e,a=`${n}-inner`,s=E(l(S).add(l(i).mul(2)).equal()),h=E(l(u).mul(2).equal());return{[n]:{[a]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:u,paddingInlineEnd:d,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${a}-checked, ${a}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:o},[`${a}-checked`]:{marginInlineStart:`calc(-100% + ${s} - ${h})`,marginInlineEnd:`calc(100% - ${s} + ${h})`},[`${a}-unchecked`]:{marginTop:l(o).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${a}`]:{paddingInlineStart:d,paddingInlineEnd:u,[`${a}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${a}-unchecked`]:{marginInlineStart:`calc(100% - ${s} + ${h})`,marginInlineEnd:`calc(-100% + ${s} - ${h})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${a}`]:{[`${a}-unchecked`]:{marginInlineStart:l(i).mul(2).equal(),marginInlineEnd:l(i).mul(-1).mul(2).equal()}},[`&${n}-checked ${a}`]:{[`${a}-checked`]:{marginInlineStart:l(i).mul(-1).mul(2).equal(),marginInlineEnd:l(i).mul(2).equal()}}}}}},ze=e=>{const{componentCls:n,trackHeight:o,trackMinWidth:i}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},ce(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:i,height:o,lineHeight:E(o),verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:e.colorTextTertiary}}),re(e)),{[`&${n}-checked`]:{background:e.switchColor,[`&:hover:not(${n}-disabled)`]:{background:e.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},qe=e=>{const{fontSize:n,lineHeight:o,controlHeight:i,colorWhite:d}=e,u=n*o,S=i/2,l=2,a=u-l*2,s=S-l*2;return{trackHeight:u,trackHeightSM:S,trackMinWidth:a*2+l*4,trackMinWidthSM:s*2+l*2,trackPadding:l,handleBg:d,handleSize:a,handleSizeSM:s,handleShadow:`0 2px 4px 0 ${new se("#00230b").setAlpha(.2).toRgbString()}`,innerMinMargin:a/2,innerMaxMargin:a+l+l*2,innerMinMarginSM:s/2,innerMaxMarginSM:s+l+l*2}},Pe=le("Switch",e=>{const n=oe(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[ze(n),Ne(n),Fe(n),De(n),Ee(n)]},qe);var He=function(e,n){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&n.indexOf(i)<0&&(o[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,i=Object.getOwnPropertySymbols(e);d<i.length;d++)n.indexOf(i[d])<0&&Object.prototype.propertyIsEnumerable.call(e,i[d])&&(o[i[d]]=e[i[d]]);return o};const Oe=m.forwardRef((e,n)=>{const{prefixCls:o,size:i,disabled:d,loading:u,className:S,rootClassName:l,style:a,checked:s,value:h,defaultChecked:b,defaultValue:p,onChange:C}=e,k=He(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[P,D]=B(!1,{value:s??h,defaultValue:b??p}),{getPrefixCls:M,direction:v,switch:f}=m.useContext(de),F=m.useContext(he),N=(d??F)||u,w=M("switch",o),H=m.createElement("div",{className:`${w}-handle`},u&&m.createElement(ge,{className:`${w}-loading-icon`})),[$,z,j]=Pe(w),T=ue(i),A=U(f==null?void 0:f.className,{[`${w}-small`]:T==="small",[`${w}-loading`]:u,[`${w}-rtl`]:v==="rtl"},S,l,z,j),O=Object.assign(Object.assign({},f==null?void 0:f.style),a),L=function(){D(arguments.length<=0?void 0:arguments[0]),C==null||C.apply(void 0,arguments)};return $(m.createElement(me,{component:"Switch"},m.createElement(Q,Object.assign({},k,{checked:P,onChange:L,prefixCls:w,className:A,style:O,disabled:N,ref:n,loadingIcon:H}))))}),G=Oe;G.__ANT_SWITCH=!0;const Ve=()=>{var W;const[e,n]=m.useState("มกราคม"),[o,i]=m.useState(new Date().getFullYear()),[d,u]=m.useState(!1),[S,l]=m.useState([]),[a,s]=m.useState(!0),[h,b]=m.useState(null),[p]=y.useForm(),[C,k]=m.useState({}),[P,D]=m.useState(0),[M,v]=m.useState(null),f=Se(),F=pe(),N=["201","202","203","204","205","206","207","208","309","310","311","312","313","314","315","316","225","226","227","228","329","330","331","332"];m.useEffect(()=>{(async()=>{s(!0);try{const r=K(f,"users"),I=(await we(r)).docs.map(x=>({id:x.id,...x.data()}));l(I)}catch(r){console.error("Error fetching users data: ",r)}finally{s(!1)}})()},[f]),m.useEffect(()=>{(async()=>{const r=o+543,g=`${e} ${r}`;try{const I=_(f,"electricityData",g),x=await Ie(I);x.exists()?k(x.data()):(console.log("No electricity data found for the selected month and year."),k(w()))}catch(I){console.error("Error fetching electricity data: ",I)}})()},[e,o,f]);const w=()=>N.reduce((r,g)=>(r[g]={previous:"0",current:"0",units:"0",amount:"0"},r),{}),H=t=>{n(t.target.value)},$=t=>{i(Number(t.target.value))},z=()=>{u(!1),p.resetFields(),D(0),v(null)},j=t=>{var g;const r=(g=t.target.files)==null?void 0:g[0];r&&r.type==="application/pdf"?v(r):R.error("กรุณาเลือกไฟล์ PDF เท่านั้น")},T=async()=>{var t;try{let r="";if(M){const x=ve(F,`invoices/${M.name}`);await xe(x,M),r=await ye(x)}const g={userId:h.id,room:h.room||"ไม่ระบุ",month:e,year:o,rent:p.getFieldValue("rent"),water:p.getFieldValue("water"),electricity:((t=C[h.room])==null?void 0:t.amount)||"ไม่ระบุ",fine:p.getFieldValue("fine"),total:P,roomStatus:p.getFieldValue("roomStatus")?"จ่ายแล้ว":"ค้างชำระ",pdfUrl:r},I=_(K(f,"invoices"));await ke(I,g),R.success("บิลแจ้งหนี้ถูกส่งเรียบร้อยแล้ว!"),u(!1),p.resetFields(),D(0),v(null)}catch(r){console.error("Error saving invoice data: ",r),R.error("เกิดข้อผิดพลาดในการส่งบิลแจ้งหนี้")}},A=t=>{var r,g;b(t),p.setFieldsValue({room:t.room||"ไม่ระบุ",rent:t.rent||"",water:t.water||"",electricity:((r=C[t.room])==null?void 0:r.amount)||"ไม่ระบุ",fine:"",roomStatus:t.roomStatus||!1,total:`${O(t.rent,t.water,(g=C[t.room])==null?void 0:g.amount)}`}),u(!0)},O=(t,r,g,I="0")=>{const x=parseFloat(t||"0"),Z=parseFloat(r||"0"),ee=parseFloat(g||"0"),ne=parseFloat(I||"0"),V=x+Z+ee+ne;return D(V),p.setFieldsValue({total:`${V}`}),V},L=(t,r)=>{var g;O(r.rent,r.water,(g=C[h==null?void 0:h.room])==null?void 0:g.amount,r.fine)},J=S.sort((t,r)=>{const g=N.indexOf(t.room),I=N.indexOf(r.room);return g-I});return c.jsxs(c.Fragment,{children:[c.jsx(fe,{}),c.jsxs("div",{className:"invoice-form-container",children:[c.jsx("h3",{children:"เลือกรอบบิล"}),c.jsx("select",{className:"form-select","aria-label":"เลือกเดือน",value:e,onChange:H,children:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"].map(t=>c.jsx("option",{value:t,children:t},t))}),c.jsx("select",{className:"form-select","aria-label":"เลือกปี",value:o,onChange:$,children:Array.from({length:10},(t,r)=>new Date().getFullYear()+r).map(t=>c.jsx("option",{value:t.toString(),children:t},t))}),a?c.jsx($e,{size:"large"}):c.jsx("div",{className:"cards-container",children:J.map(t=>c.jsxs(Me,{title:`ห้อง: ${t.room||"ไม่ระบุ"}`,bordered:!0,style:{width:300,marginTop:16,cursor:"pointer"},onClick:()=>A(t),children:[c.jsxs("p",{children:["ค่าเช่า: ",t.rent]}),c.jsxs("p",{children:["ค่าน้ำ: ",t.water]})]},t.id))}),c.jsx(Ce,{title:`ออกใบแจ้งหนี้ห้อง ${(h==null?void 0:h.room)||"ไม่ระบุ"}`,visible:d,onCancel:z,onOk:T,okText:"ส่งบิล",children:c.jsxs(y,{form:p,onValuesChange:L,children:[c.jsx(y.Item,{name:"room",label:"ห้อง",children:c.jsx(q,{disabled:!0})}),c.jsx(y.Item,{name:"rent",label:"ค่าเช่า",rules:[{required:!0,message:"กรุณากรอกค่าเช่า"}],children:c.jsx(q,{type:"number"})}),c.jsx(y.Item,{name:"water",label:"ค่าน้ำ",rules:[{required:!0,message:"กรุณากรอกค่าน้ำ"}],children:c.jsx(q,{type:"number"})}),c.jsx(y.Item,{name:"electricity",label:"ค่าไฟ",children:c.jsx(q,{value:((W=C[h==null?void 0:h.room])==null?void 0:W.amount)||"ไม่ระบุ",disabled:!0})}),c.jsx(y.Item,{name:"fine",label:"ค่าปรับ",children:c.jsx(q,{type:"number"})}),c.jsx(y.Item,{name:"roomStatus",label:"สถานะห้อง",children:c.jsx(G,{defaultChecked:!1})}),c.jsx(y.Item,{name:"total",label:"รวม",children:c.jsx(q,{disabled:!0})}),c.jsx(y.Item,{label:"ไฟล์ PDF",children:c.jsx("input",{type:"file",accept:"application/pdf",onChange:j})})]})})]}),c.jsx(be,{})]})};export{Ve as default};
